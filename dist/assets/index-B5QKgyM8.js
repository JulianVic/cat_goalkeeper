!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const s of e)if("childList"===s.type)for(const e of s.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();class e extends Phaser.Scene{constructor(){super("bootGame")}preload(){this.load.image("background","/assets/soccer_goal.jpg"),this.load.image("cat_goalkeeper","/assets/cat_goalkeeper.png"),this.load.image("cat_ball","/assets/cat_ball.png"),this.load.audio("bg_music","/assets/audio/bg_music.mp3")}create(){this.add.text(20,20,"Loading Game..."),this.scene.start("playGame")}}class t extends Phaser.Scene{constructor(){super("playGame")}init(){this.goals=0,this.lives=3,this.goalkeeperDirection=1,this.isPointerActive=!1,this.line=new Phaser.Geom.Line,this.goalkeeperSpeed=1,this.goalkeeperHitboxWidth=.35,this.goalkeeperHitboxX=110,this.gameTime=0}updateTimeDisplay(){this.timeText.setText(`Time: ${this.gameTime}s`)}updateLivesDisplay(){this.livesText.setText(`Lives: ${this.lives}`)}updateGoalsDisplay(){this.goalsText.setText(`Goals: ${this.goals}`)}create(){this.goalCorners=[{x:this.sys.game.config.width/7.7,y:this.sys.game.config.height-330},{x:this.sys.game.config.width/7.7,y:this.sys.game.config.height-710},{x:this.sys.game.config.width-250,y:this.sys.game.config.height-710},{x:this.sys.game.config.width-250,y:this.sys.game.config.height-330}],this.createBackground(),this.createGoalkeeper(),this.createBall(),this.createText(),this.setupEventHandlers(),this.setupWorkers()}createBackground(){this.background=this.add.image(0,0,"background"),this.background.setDisplaySize(this.sys.game.config.width,this.sys.game.config.height),this.background.setOrigin(0,0)}createGoalkeeper(){this.cat_goalkeeper=this.add.image(this.sys.game.config.width/2,this.sys.game.config.height/2+60,"cat_goalkeeper"),this.cat_goalkeeper.setDisplaySize(700,700)}createBall(){this.cat_ball=this.add.image(this.sys.game.config.width/2,this.sys.game.config.height-100,"cat_ball"),this.cat_ball.setDisplaySize(200,200),this.cat_ball.setScale(.2,.2)}createText(){this.stateText=this.add.text(20,20,"Playing game",{font:"25px Arial",fill:"lime"}),this.goalsText=this.add.text(20,60,`Goals: ${this.goals}`,{font:"25px Arial",fill:"lime"}),this.livesText=this.add.text(20,100,`Lives: ${this.lives}`,{font:"25px Arial",fill:"lime"}),this.timeText=this.add.text(20,140,"Time: 0s",{font:"25px Arial",fill:"lime"})}setupEventHandlers(){this.input.on("pointerdown",this.startDrawing,this),this.input.on("pointermove",this.drawLine,this),this.input.on("pointerup",this.shoot,this)}setupWorkers(){this.goalkeeeperStatsWorker=new Worker("src/workers/goalkeeper-stats-worker.js"),this.gameStatsWorker=new Worker("src/workers/game-stats-worker.js"),this.gameStatsWorker.postMessage("start"),this.goalkeeeperStatsWorker.onmessage=this.handleGoalkeeperStatsMessage.bind(this),this.gameStatsWorker.onmessage=this.handleGameStatsMessage.bind(this),this.soundWorker=new Worker("src/workers/sound-worker.js"),this.soundWorker.postMessage("start"),this.soundWorker.onmessage=e=>{"play"===e.data.action?(this.bgMusic=this.sound.add("bg_music",{loop:!0}),this.bgMusic.play()):"stop"===e.data.action&&this.bgMusic&&this.bgMusic.stop()}}handleGoalkeeperStatsMessage(e){this.goalkeeperSpeed=e.data.level,this.goalkeeperHitboxX=e.data.x,this.goalkeeperHitboxWidth=e.data.width}handleGameStatsMessage(e){switch(e.data.type){case"time":this.gameTime=e.data.value,this.updateTimeDisplay();break;case"goals":this.goals=e.data.value,this.updateGoalsDisplay();break;case"lives":this.lives=e.data.value,this.updateLivesDisplay();break;case"gameover":this.endGame();break;case"reset":this.resetGame(e.data)}}startDrawing(e){e.y>this.cat_ball.y-this.cat_ball.displayHeight/2&&(this.isPointerActive=!0,this.line.x1=this.cat_ball.x,this.line.y1=this.cat_ball.y)}drawLine(e){this.isPointerActive&&(this.line.x2=e.x,this.line.y2=e.y)}shoot(){this.isPointerActive&&(this.isPointerActive=!1,this.tweens.add({targets:this.cat_ball,x:this.line.x2,y:this.line.y2,scaleX:.1,scaleY:.1,duration:1e3,ease:"Power2",onComplete:()=>this.checkGoal()}))}checkGoal(){let e=new Phaser.Geom.Polygon(this.goalCorners);Phaser.Geom.Polygon.Contains(e,this.cat_ball.x,this.cat_ball.y)?this.isGoalkeeperBlocking()?(this.displayGoalResult("¡Atajado! Has perdido una vida."),this.gameStatsWorker.postMessage("miss")):(this.goalkeeeperStatsWorker.postMessage("goal"),this.gameStatsWorker.postMessage("goal"),this.displayGoalResult("¡Gol! Has anotado.")):(this.displayGoalResult("¡Fuera! Has perdido una vida."),this.gameStatsWorker.postMessage("miss")),this.tweens.add({targets:this.cat_ball,x:this.sys.game.config.width/2,y:this.sys.game.config.height-100,scaleX:.2,scaleY:.2,duration:1e3,ease:"Power2",onComplete:()=>{this.time.delayedCall(500,(()=>{this.isPointerActive=!0}))}})}isGoalkeeperBlocking(){let e=new Phaser.Geom.Rectangle(this.cat_goalkeeper.x-this.goalkeeperHitboxX,this.cat_goalkeeper.y-this.cat_goalkeeper.displayHeight/3,this.cat_goalkeeper.displayWidth*this.goalkeeperHitboxWidth,.56*this.cat_goalkeeper.displayHeight);return Phaser.Geom.Rectangle.Contains(e,this.cat_ball.x,this.cat_ball.y)}resetGame(e){this.goals=e.goals,this.lives=e.lives,this.gameTime=e.time,this.goalkeeperSpeed=1,this.goalkeeperHitboxWidth=.35,this.goalkeeperHitboxX=110,this.updateTimeDisplay(),this.updateLivesDisplay(),this.goalsText.setText(`Goals: ${this.goals}`),this.scene.restart()}displayGoalResult(e){this.resultText&&this.resultText.destroy(),this.resultText=this.add.text(this.sys.game.config.width/2,this.sys.game.config.height/2,e,{font:"64px Arial",fill:"#ffffff",backgroundColor:"#000000",padding:{x:20,y:10}}),this.resultText.setOrigin(.5),this.resultText.setDepth(1),this.time.delayedCall(3e3,(()=>{this.resultText&&this.tweens.add({targets:this.resultText,alpha:0,duration:500,ease:"Power2",onComplete:()=>{this.resultText.destroy(),this.resultText=null}})}))}moveGoalkeeper(e,t){e.x+=t*this.goalkeeperDirection,e.x>=this.goalCorners[3].x?this.goalkeeperDirection=-1:e.x<=this.goalCorners[0].x&&(this.goalkeeperDirection=1)}update(){this.moveGoalkeeper(this.cat_goalkeeper,this.goalkeeperSpeed)}endGame(){this.goalkeeeperStatsWorker.terminate(),this.gameStatsWorker.terminate(),this.soundWorker.postMessage("stop"),this.soundWorker.terminate(),this.bgMusic&&this.bgMusic.stop(),this.tweens.killAll(),this.time.removeAllEvents(),this.scene.start("gameOver",{time:this.gameTime,goals:this.goals})}}class s extends Phaser.Scene{constructor(){super("gameOver")}init(e){this.finalTime=e.time,this.finalGoals=e.goals}create(){this.add.text(this.sys.game.config.width/2,this.sys.game.config.height/2-100,"Juego Terminado",{font:"64px Arial",fill:"#ffffff"}).setOrigin(.5),this.add.text(this.sys.game.config.width/2,this.sys.game.config.height/2,`Tiempo: ${this.finalTime}s`,{font:"48px Arial",fill:"#ffffff"}).setOrigin(.5),this.add.text(this.sys.game.config.width/2,this.sys.game.config.height/2+100,`Goles: ${this.finalGoals}`,{font:"48px Arial",fill:"#ffffff"}).setOrigin(.5),this.add.text(this.sys.game.config.width/2,this.sys.game.config.height/2+200,"Haga clic para volver a comenzar",{font:"64px Arial",fill:"#ffffff"}).setOrigin(.5),this.input.once("pointerdown",(()=>{this.scene.start("playGame")}))}}var i={type:Phaser.AUTO,scale:{mode:Phaser.Scale.FIT,autoCenter:Phaser.Scale.CENTER_BOTH,width:1920,height:1080,backgroundColor:0},physics:{default:"arcade",arcade:{gravity:{y:800},debug:!1}},scene:[e,t,s]};new Phaser.Game(i);
